{"name":"24h_bp_js_version","steps":[{"processorData":"function compute(ctx, src) {\n    var promises = {\n        bpData: Ehr.query({\n            aql:\n                'SELECT ' +\n                'w/data[at0001]/events[at1042]/data[at0003]/items[at0004]/value AS systolic_24h_mean, ' +\n                'w/data[at0001]/events[at1042]/data[at0003]/items[at0005]/value AS diastolic_24h_mean, ' +\n                'w/data[at0001]/events[at0006,\\'24 hour daytime average\\']/data[at0003]/items[at0004]/value AS systolic_day_mean, ' +\n                'w/data[at0001]/events[at0006,\\'24 hour daytime average\\']/data[at0003]/items[at0005]/value AS diastolic_day_mean, ' +\n                'w/data[at0001]/events[at0006,\\'24 hour nighttime average\\']/data[at0003]/items[at0004]/value AS systolic_night_mean, ' +\n                'w/data[at0001]/events[at0006,\\'24 hour nighttime average\\']/data[at0003]/items[at0005]/value AS diastolic_night_mean, ' +\n                'w/data[at0001]/events[at1042]/time/value AS measurement_date, ' +\n                'c/context/start_time/value AS composition_creation_time ' + // time when the composition was created\n                // ', e/ehr_id/value AS ehr_id ' +\n                'FROM EHR e ' +\n                'CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.encounter.v1] ' +\n                'CONTAINS OBSERVATION w[openEHR-EHR-OBSERVATION.blood_pressure.v2] ' +\n                'ORDER BY measurement_date DESC ' +\n                'LIMIT 50',\n            //params: ctx.vars,\n            params: {ehrId: '5066c8b2-2c0b-4a84-83c1-fbf193ea9a75'}, // hardcoded ehr_id for testing\n            initvalue: [],\n            callback: function (out, row) {\n                    out.push({\n                        composition_creation_time: row['composition_creation_time'],\n                        measurement_date: row['measurement_date'],\n                        systolic_day_mean: row['systolic_day_mean'] ? row['systolic_day_mean'].magnitude : null,\n                        diastolic_day_mean: row['diastolic_day_mean'] ? row['diastolic_day_mean'].magnitude : null,\n                        systolic_24h_mean: row['systolic_24h_mean'] ? row['systolic_24h_mean'].magnitude : null,\n                        diastolic_24h_mean: row['diastolic_24h_mean'] ? row['diastolic_24h_mean'].magnitude : null,\n                        systolic_night_mean: row['systolic_night_mean'] ? row['systolic_night_mean'].magnitude : null,\n                        diastolic_night_mean: row['diastolic_night_mean'] ? row['diastolic_night_mean'].magnitude : null\n                    });\n            }\n        })\n    };\n\n    var result = {};\n    Ehr.allhash(promises, function (res) {\n        result = {\n            measurements: res['bpData']\n        };\n    });\n    return result;\n}\n","processorName":"js"}],"metaData":"{\"parameters\":[]}"}